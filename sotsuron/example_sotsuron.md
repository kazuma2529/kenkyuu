# フラン鋳型における鋳物砂粒子の配位数計測プログラムの開発

### 融体加工研究室 化 20-0092 酒井 翔護

## 1. 緒言

フラン鋳型は、有機自硬性鋳型の中でも主流となるものの一つである 1)。砂の再利用性、鋳物の寸法精度や鋳肌の品質が良い事が特徴であり、粘結剤として使われるフラン樹脂は非可食バイオマス原料由来のためカーボンニュートラルの観点からも注目されている 2)。一方、フラン樹脂は有機物である事からガス欠陥や環境への悪影響の原因となるため、少量での使用が望ましいが、少量にすると鋳型強度が低下する。そのため、鋳型内の砂の充填構造を最適化することで強度を向上させる事ができれば、フラン樹脂の添加量を少量にできると考えられる。本研究では、フラン鋳型の内部構造の理解のために X 線CT の出力画像から鋳物砂粒子の配位数を求めるプログラムの設計を検討した。

## 2. 実験

フラン鋳型試料片を撮影した X 線 CT の二次元断面出力画像を基に三次元画像を生成し、鋳物砂粒子が存在する領域を区別するために二値化を行った。二値化には大津の二値化 3)を使用した。さらに、二値化した砂粒子表面から近接する砂粒子までの距離と方向を定量化するために距離変換処理を行った。計算時間と計算精度を考慮して、距離変換の距離関数にはマンハッタン距離を用いた。二値化した三次元画像において接触している砂が、合体した一つの粒子として誤認されるのを避けるため、距離変換の結果を用いて、粒子を個別に認識するラベリング処理を行った。ラベリングでは、砂表面から中心に向かって砂の画像領域を縮小させたときに近接する砂の画像と分離独立させることで行った。画像の縮小の模式図を Fig. 1 に示す。(a)より、二値化された画像には粒子が接触して合体しているものや粒子表面に X 線 CT 測定のアーチファクト由来のノイズが存在する。(b)および(c)より、画像を縮小していくとノイズは粒子から分離して消滅する。また、(c)では合体していた粒子が分離して認識される。しかし、縮小量が過剰になると(d)に示すように粒子が消滅する。このように分離と消滅を考慮しつつ適当な画像収縮を行う必要があることから画像収縮と粒子の分離・消滅の関係を調べた。

## 3. 結果・考察

Fig.2 に 14 回の画像収縮を行った際に認識される粒子とその粒子が合体する画像収縮回数の関係を示す。収縮回数が 8～10 回程度まで多くなるほど粒子の合体数は小さくなるが、さらに収縮回数が多くなると合体数が増加した。この画像処理条件では粒子を個別に認識できる可能性が高い収縮回数は 8～10 回程度であることが分かった。画像収縮回数を変化させて同様な検討を行った結果、ノイズは収縮回数の増加によって粒子から分離後すぐに消滅する傾向があり、収縮回数が多くなり粒子が消滅する直前では粒子が複数に分離して認識される傾向があった。これらのことから、粒子の認識（ラベリング）には、画像収縮によって合体粒子の分離を考慮するとともに、ノイズの誤認回避とまた粒子消滅直前における粒子の分離を考慮する必要性が明らかになった。

## 参考文献

1. 黒川 豊, 簑輪 幸三, 丸山 徹, 鋳造工学 90巻(2018) 8号 p.474.
2. 黒川 豊, 木内 一彦, 鋳造工学 89巻(2017) 8号 p.517.
3. N. Otsu: IEEE Trans. Sys., Man, and Cyber., 9, 1(1979), p62-66.

---

# 目次

頁

1.  緒言 1
2.  計算方法 1
    2.1 アルゴリズム 1
    2.1.1 X 線 CT 像の二値化処理 1
    2.1.2 距離変換処理 1
    2.1.3 ラベリング処理 2
    2.1.4 配位数測定 3
    2.2 プログラミング 3
3.  計算結果および考察 3
    3.1 画像収縮による領域の分離から消滅の傾向 3
    3.2 配位数に及ぼすラベリング条件の影響 4
4.  結言 4

5.  参考文献 \*4

謝辞

---

## 1. 緒言

鋳型は、鋳物を作製するときに用いられる溶湯を流し込む型である。鋳型の一種に砂粒同士(珪砂等)を粘結剤で接着することにより造型する砂型があり、砂型の一種に有機自硬性鋳型がある。有機自硬性鋳型は、鋳物砂に粘結剤と硬化剤を混錬し、鋳物砂同士を接着することで造型される。フラン鋳型は、有機自硬性鋳型の中でも主流となるものの一つである 1)。砂の再利用性、鋳物の寸法精度や鋳肌の品質が良い事が特徴であり、粘結剤として使われるフラン樹脂は非可食バイオマス原料由来のためカーボンニュートラルの観点からも注目されている 2)。一方、フラン樹脂は有機物である事からガス欠陥の原因となる。また、造型時にホルムアルデヒド、注湯時に亜硫酸ガスが発生し作業環境への悪影響の原因となる 3)ため、少量での使用が望ましいが、少量にすると鋳型強度が低下する。そのため、鋳型内の砂の充填構造を最適化することで強度を向上させる事ができれば、フラン樹脂の添加量を少量にできると考えられる。X 線 CT を用いてシェル鋳型抗折力試験片の内部構造を解析した事例がある4)ことから、充填構造を観察する方法として、 X 線 CT を用いた手法が想像できる。ここで、材料は異なるがフラン鋳型と内部構造が類似しているポーラスコンクリート（以下 POC）に着目する。POC は、骨材とペーストからなるコンクリートの一種である。POC において、骨材の配位数の増加は圧縮強度の増加の要因とされている 5)。一方で、フラン鋳型において鋳物砂粒子の配位数の増加が圧縮強度の向上に寄与するかは検証されていない。本研究では、フラン鋳型の内部構造の理解のために X 線 CT の出力画像から鋳物砂粒子の配位数を求めるプログラムの設計を検討した。

## 2. 計算方法

### 2.1 アルゴリズム

#### 2.1.1 X 線 CT 像の二値化処理

まず、X 線 CT を用いた観察手法について説明する。これは、試料に X 線をコーンビーム状に照射し、光軸内で回転させて検出器に拡大投影するという手法である 6)。試料を透過し減衰した X 線を検出器で測定することで、X 線の強度が二次元像として測定される。得られたデータに再構成処理を行うことにより、試料の断面画像が得られる。この画像はグレイスケールであり、X 線が透過しにくい領域が白く映る。断面画像を積層した出力画像を基に三次元画像を生成し、鋳物砂粒子が存在する領域を区別することを試みた。上述の通り X 線出力データはグレイスケールであり、鋳物砂粒子と空間の境界線は必ずしも明確ではない。そのため砂粒子と空間あるいは樹脂との境界を明確にするためにグレイスケールのデータを二値化によって白黒画像にする必要がある。Fig. 1 にグレイスケールの画像とそれを二値化した画像の例を示す。同図上段に示す画像において矢印で示した領域は砂粒子の境界であるがその輪郭は不明瞭である。そこで、一義的に輪郭を明瞭にする処理として大津の二値化 7)を行った。大津の二値化では画像の明度ヒストグラムから大域最適な K 平均法によりグレイスケールの画像を白と黒の二つの値に変換する手法である。Fig. 1 の下段に示すように二値化によって輪郭は明瞭となり鋳物砂とそれ以外を一義的に扱えるようにした。

#### 2.1.2 距離変換処理

フラン鋳型の X 線 CT 像を二値化した断面像の例を Fig. 2 に示す。”Sand area”と示した白色領域が鋳物砂であり、”Void”で示した黒色領域が空隙あるいは粘結剤に相当する領域である。鋳物砂を角のある粒子として視認することができるが多くの粒子が接しており、白色領域としては連続してつながっている粒子が多く認められる。配位数の測定においては、つながっている粒子を分離して認識する必要があり、そのための手法として Watershed 法が知られており、この方法では抽出する領域の中心を地形の起伏の谷、領域同士の境界を地形の尾根とそれぞれみなし、山地に降り注ぐ雨水が分水嶺に両側に流れ込むように、その尾根を境界として領域を分割する処理である 8)。すなわち、Fig. 2 でつながっている粒子のくびれ部分が領域分割境界として判定する手法である。この方法を用いる場合は、抽出する粒子画像から地形の標高データに相当するデータが必要となる。そこで、白色で示される砂粒子中心からの距離を Watershed 法で用いる起伏（標高）のデータとして扱うこととした。
この距離を求めるためのデータ処理（距離変換）として、マンハッタン距離を採用した。Fig. 3 にひとつのピクセルが正方形のデジタル像とマンハッタン距離の関係を模式図で示す。同図の中心に位置するピクセルが砂粒子の中心と考えたとき、中心ピクセルの 4 辺に接するピクセルとの距離を 1 とする。1 ピクセル遠くなるにつれて距離が 1 ずつ遠くなる。この手法では中心ピクセルから斜め 45°の位置にあるピクセル前の距離が実際の距離よりも課題評価されることになるが、計算時間が短いことが利点である。この距離変換によって、砂粒子表面から近接する砂粒子までの距離と方
向を定量化することができ、距離変換データを Watershed 法による領域分割処理に用いた。

### 2.1.3 ラベリング処理

二値化した画像から粒子を認識する処理（ラベリング）をするためには Watershed 法が有効であるが、X 線 CT 像ではいくつかの要因でアーチファクト 9)による画像ノイズが生じる場合があり、 Watershed 法を単純に用いるだけではノイズの影響が無視できない。特に砂のように角のある粒子の場合、屈折による輪郭が過剰に協調され、粒子表面から線状のコントラストが生じる場合がある。
実際に前掲 Fig. 2 でも鋳物砂表面からかすれた線のような白色領域が認められる。このようなコントラストはノイズであり、Watershed 法で粒子境界を求める前に除外する必要がある。そこで可能な限り砂粒子のみをラベリングを行うために距離変換のデータを用いてラベリング処理を行うこととした。
ラベリング処理では、砂表面から中心に向かって砂の画像領域をマンハッタン距離に応じて縮小させたときに近接する砂の画像と分離独立させることで行った。画像の縮小の模式図を Fig. 4 に示す。(a)より、二値化された画像には粒子が接触して合体しているものや粒子表面に X 線 CT 測定のアーチファクト由来のノイズが存在する。(b)および(c)より、画像を縮小していくとノイズは粒子から分離して消滅する。また、(c)では合体していた粒子が分離して認識される。しかし、縮小量が過剰になると(d)に示すように粒子が消滅する。このように分離と消滅を考慮しつつ適当な画像収縮を行う必要があることから画像収縮と粒子の分離・消滅の関係を調べた。
粒子の分離・消滅と画像収縮回数との関係を調べた後には、砂粒子の認識に最適と考えられる画像収縮過程の分離・消滅条件を設定してラベリングを行った。前掲 Fig. 4 に示したように画像収縮回数を増加していくとどの粒子も最終的には消滅する。砂粒子の場合は画像収縮によってその領域は徐々に小さくなると考えられる。一方で、ノイズの場合は前掲 Fig. 2 で示したように細長いかすれた線状の領域である場合が多く、このような領域は画像収縮によって複数の小さな領域に分離した後に消滅することになるが、ノイズは線状であることから分離から消滅までの画像収縮回数は小さいと考えられる。そこで画像収縮によって粒子が消滅する直前の画像収縮回数から 1～3 回画像収縮しても消滅しなかった領域を砂粒子と判定することとした。

### 2.1.4 配位数測定

ラベリングをした粒子について、消滅する画像収縮回数から収縮回数が 1～3 回前の画像の中心
をその粒子の中心部と定義して、Watershed 法により隣接する粒子と接した粒子数を配位数とした。

### 2.2 プログラミング

開発環境には OS が Windows 10 pro の PC を用いた。プロセッサは 12th Gen Intel(R) Core(TM) i712700T、RAM の容量は 32GB であった。三次元画像処理の際に RAM を多く消費するため、RAM の容量が多い PC を用意した。プログラミング言語には Python を用い、ライブラリとして
NumPy、OpenCV を用いた。NumPy は Python で数値計算を効率的に行うためのライブラリで、多次元配列の操作を容易に行うことができる。OpenCV は画像処理、画像解析に用いるライブラリである。二次元画像の処理を容易に行うことができる。次に、どの場面でそれぞれのライブラリを用いたか説明する。NumPy はプログラムの全域で用いられた。OpenCV はラベリングの際に用いた。OpenCV で断面画像にラベリング処理を行い、出力画像群を断面と垂直な方向に紐づけ、三次元画像のラベリングを行った。

## 3. 計算結果および考察

### 3.1 画像収縮による領域の分離から消滅の傾向

Fig. 5 から Fig. 26 に 1 回から 22 回の画像収縮を行った画像を元にして、画像収縮回数を 1 段階ずつ減少させる毎に粒子が合体した回数をそれぞれ示す。横軸はその画像の収縮回数 n から画像収縮回数を減少させた回数 d の差（n-d）を示し、縦軸は画像収縮を 1 段階減少させた際に合体した粒子数を示す。
Fig. 5 は画像収縮回数が 1 回のため n=1 であり、その画像を 1 回収縮させた場合(d=1)に合体した粒子が約 4500 であったことを示す。横軸の値は n-d より 0 である。1 回の収縮で約 4500 の粒子が分離していることから、この分離は Fig. 4 の(b)から(c)への画像収縮のように、粒子領域が僅かに接触して粒子が分離したことを示していると考えられる。また、Fig. 4 の(a)から(b)へのようにノイズが分離したことも考えられることから 1 回の収縮でラベリングを判断するのは不適当と考えられる。
画像収縮回数が 1～4 回（Fig. 5～8）までは横軸の値が変化しても分離する粒子数にほとんど変化は認められなかった。なお、Fig. 5 で示す分離粒子数は約 4500 に対して Fig. 8 では約 4000 であることから約 500 の粒子領域が 1～4 回の画像収縮の間に消滅したことを意味しており、これらはノイズである割合が大きいと考えられる。
画像収縮回数が 5～17 回（Fig. 9～21）の結果では横軸の値(n-d)が増加するとともに分離粒子数は減少したのちに増加する傾向を示した。すなわち横軸の値に対して分離粒子数は極小値を示した。この極小値は d が 1～6 のときであり、画像収縮回数が大きくなるほど極小値を示す d は大きくなった。極小値では分離粒子数が小さいことを意味するので隣接する粒子領域と接していない独立した領域が分離単純に収縮する粒子が比較的多い画像収縮条件であることを意味する。このような粒子はノイズである割合は小さいと考えられる。
画像収縮回数が 18～22 回（Fig. 22～26）では縦軸の分離粒子数から読み取れるように粒子数が 1～16 と少なかった。これは画像収縮回数が大きくなるとほとんどの粒子領域が消滅しており、サイズの大きな砂粒子のみが残っていることを意味している。画像収縮前の個々のノイズ領域は小さいことから、これらの粒子はノイズである可能性は低いと考えられる。一方で、一つの粒子であってもその領域形状にくびれがある場合では画像収縮過程で分離することが考えられる。この形状由来の分離は画像収縮による領域の消滅直前に生じると考えられる。以上の結果より、画像収縮による粒子領域の分離・合体にはノイズ由来や形状由来のものが含まれると考えられ、これらをラベリングから除外する必要がある。実際の X 線 CT 測定した二値化画像から画像収縮過程を確認したところ、ノイズは収縮回数の増加によって粒子領域から分離後すぐに消滅する傾向があり、粒子領域が消滅する直前では粒子が複数に分離する傾向があった。これらのことから、粒子の認識（ラベリング）には、画像収縮によって合体粒子の分離を考慮するとともに、ノイズの誤認回避と粒子消滅直前における粒子の分離を考慮する必要性が明らかとなった。そこで、消滅直前の粒子領域が画像収縮回数を 1 回（d=1）減じたときに合体する粒子はラベリングから除外することとし、この d を
1～3 に変化させてラベリングを判定した時の配位数を評価することとした。

### 3.2 配位数に及ぼすラベリング条件の影響

Fig. 27 にラベリング除外条件とラベリングされた粒子領域数、配位数の関係を示す。横軸は消滅直前の粒子領域が画像収縮回数を減じることで他の領域と合体するまでの回数（画像膨張回数）を示す。すなわち、ラベリングから除外する粒子合体画像膨張回数に相当する。この回数を 1～3 に変化してもラベリングされる粒子数は 2020～2019 個であり、ほとんど変化が無かった。これは砂粒子の形状が粒状であり、くびれの程度は無視できるほど小さいためと考えられる。配位数は何れも 4.92 であり、画像膨張回数が 3 回の場合で若干増加したが、画像膨張回数による違いは認められなかった。画像膨張回数が 3 回ではラベリングされた粒子数が 1 つだけ減少し、それに伴い計測された接点数は 3 つ減少したため、配位数としてはほとんど変化しなかった。
シェル鋳型の砂接点数を調べた長井らの結果では AFS 粒度 72 の天然けい砂で 1mm3当たり 64 個と報告されている。Fig. 27 の結果から換算すると 50～60 と見積もられた。以上のことから大津の二値化、画像収縮法および Watershed 法による配位数測定は妥当であると考えられる。一方で X 線
CT の画像解像度の影響など元データの影響についてはさらなる検討が必要と考えられる。

## 4. 結言

フラン鋳型の内部構造の理解のために X 線 CT の出力画像から鋳物砂粒子の配位数を求めるプログラムとして、大津の二値化、画像収縮法および Watershed 法によるラベリングを行った結果、以下のことが分かった。
(1) ノイズは収縮回数の増加によって粒子から分離後すぐに消滅する傾向がある。
(2) 収縮回数が多くなり粒子が消滅する直前では粒子が複数に分離して認識されると考えられたが、粒子の認識（ラベリング）に及ぼす影響は小さい。
(3) ラベリングには、画像収縮によって合体粒子の分離を考慮するとともに、ノイズの誤認回避とまた粒子消滅直前における粒子の分離を考慮する必要性がある。
(4) 上記の方法で配位数測定を行った結果、粒子１個あたりの配位数は 4.92 であった。

### 5. 参考文献

1. 黒川 豊, 簑輪 幸三, 丸山 徹, 鋳造工学 90 巻(2018) 8 号 p.474.
2. 黒川 豊, 木内 一彦, 鋳造工学 89 巻(2017) 8 号 p.517.
3. 小谷 友勝, 佐藤 理紗, 荻野 知也, 安達 将志, 目次 真一, 鋳造工学 全国講演大会講演概要集,
   164(2014) 42 p. 42
4. 長井 壮一, 枝根 和也, 天久 裕樹, 黄 子争, 黒川 豊, 鋳造工学 全国講演大会講演概要集,
   167(2015) 97 p. 98
5. 浅野 勇, 向後 雄二, 林田 洋一, 農業土木学会論文集 2006 巻(2006) 246 号 p. 931-938 6) 田中 俊敬, 久我 瑞樹, 杉山 和也, 軽金属, 71 巻(2021) 9 号 p. 417-424
6. N. Otsu: IEEE Trans. Sys., Man, and Cyber., 9, 1(1979), p.62-66.
7. 戸田裕之，X 線 CT －産業・理工学でのトモグラフィー実線活用－，(共立出版，東京，2019), p.385-387.
8. 戸田裕之，X 線 CT －産業・理工学でのトモグラフィー実線活用－，(共立出版，東京，2019), p.355-367.

---

## 謝辞

本研究を遂行するにあたり、終始多大なるご指導を賜りました関西大学化学生命工学部化学・物質工学科教授、博士(工学)、丸山 徹先生に深く感謝の意を表します。並びに、種々の御指導を下さいました関西大学化学生命工学部化学・物質工学科の諸先生方に深く感謝の意を表すとともに、技術的な御指導を賜りました堂本 涼介技師に心より御礼申し上げます。そして、種々のご指導を下さいました吉迫 竜也 客員研究員、神野 舞香 大学院生、八田 直也 大学院生、並びに令和 5 年度融体加工研究室の皆様に厚く御礼申し上げます。

---

Fig. 1 二値化の模式図

内容: 上段のぼやけたグレースケール画像（境界が不明瞭な領域）が、下段ではくっきりとした白と黒の二値画像に変換される様子。

意味: 「大津の二値化」により、砂粒子と空間を客観的な境界で切り分ける処理を示しています。

Fig. 2 フラン鋳型試料のX線CT像

内容: 実際の断面画像。白色の領域（砂粒子）が密集しており、その間に黒色の隙間（空隙・樹脂）が存在する。

意味: 多くの砂粒子が互いに接触して繋がって見えており、これらを個別に分離（ラベリング）する必要があることを示唆しています。

Fig. 3 マンハッタン距離の模式図

内容: 5×5の格子状ピクセル。中心を「0」とし、上下左右に移動するごとに数値が1ずつ増えていく様子。

意味: 計算負荷を抑えつつ、砂粒子の表面から中心部までの距離を定量化するための距離関数の定義を示しています。

Fig. 4 画像収縮（縮小）の模式図

内容: (a)接触した粒子とノイズ → (b)ノイズが分離 → (c)粒子同士が分離 → (d)過剰収縮で粒子が消滅、という4段階のプロセス。

意味: 画像を「削る」ことで、くっついた粒子を切り離し、かつノイズを除去するアルゴリズムの仕組みを説明しています。

Fig. 5 ～ Fig. 8（収縮回数 1回～4回）

特徴: 棒グラフの粒子数が約4000～4500個と非常に多い。

意味: 収縮が不十分なため、まだ微細な「ノイズ」を砂粒子として誤認識している段階です。

Fig. 9 ～ Fig. 14（収縮回数 5回～10回）

特徴: グラフに凹凸（極小値）が現れ始める。

意味: 収縮が進むことでノイズが消え、くっついていた粒子が適切に分離され始めた状態。論文内では「8～10回」が個別に粒子を認識できる可能性が高い適切な範囲とされています。

Fig. 15 ～ Fig. 20（収縮回数 11回～16回）

特徴: グラフ全体の粒子数（縦軸）が急激に減少していく。

意味: 収縮が強すぎて、本来の砂粒子自体が画像から消滅（消失）し始めている段階です。大きな粒子のみが残っています。

Fig. 21 〜 Fig. 26（収縮回数 17回 〜 22回）
内容: 収縮回数を極限まで増やした際のグラフ。

Fig. 21・22: 粒子数が数十個単位まで減少。

Fig. 23・24: 粒子数が10個以下まで減少。

Fig. 25・26: 最終的に粒子数が1〜4個程度まで消失。

意味: 「収縮回数を増やしすぎると、ノイズだけでなく本物の砂粒子もほぼ全て消滅してしまう」ことを示しています。これにより、解析にはこれほど強い収縮は不要であり、大きな粒子のみが最後に残るという性質を確認しています。

Fig. 27（ラベリング条件と配位数の関係）
内容: ラベリングの「除外条件（画像膨張回数）」を1〜3回と変化させた際、認識された「粒子数（黒丸）」と「配位数（白丸）」がどう変化するかを示したグラフ。

粒子数: 条件を変えても 約2020個 でほぼ一定。

配位数: 条件を変えても 約4.92 で横ばい。

意味: このプログラムの安定性と妥当性を証明する最も重要なデータです。「ノイズ判定の基準を少し変えた程度では、最終的な配位数の結果（4.92）は揺るがない」ことを示しており、この手法がフラン鋳型の内部構造解析において信頼できるものであると結論付けています。
